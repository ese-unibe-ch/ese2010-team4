<!DOCTYPE html>

<html>
    <head>
        <title>#{get 'title' /}</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <link rel="stylesheet" type="text/css" media="screen" href="@{'/public/stylesheets/main.css'}">
        #{get 'moreStyles' /}
	        <link rel="shortcut icon" type="image/png" href="@{'/public/images/Icon.png'}">
	        <script src="@{'/public/javascripts/jquery-1.4.2.min.js'}" type="text/javascript" charset="utf-8"></script>	     
	        <script src="@{'/public/javascripts/flot/jquery.flot.js'}" type="text/javascript" charset="utf-8"></script>
	        <script src="@{'/public/javascripts/scroll.js'}" type="text/javascript"></script>
	        #{script 'validationScript.js' /}
	       	#{script 'jquery.highlightRegex.js' /}
	       	
	       	<script type="text/javascript">
				var userExists = #{jsAction @Application.userExists( ':username' ) /}
			</script>
	        
        #{get 'moreScripts' /}
    </head>
    <body>
    	<div id="main">
	    	<div id="main-right">
	    		#{if user}
				<div id="user">
					<div id="userImg"> <img src="${user.avatarPath}" width="62" height="62"/></div>
					<div>User: ${user.username}</div>
					<div>Reputation: ${user.rating}</div>
					<a class="button" href="@{Users.myProfile(user.id)}">My Profile</a>
					<a class="button" id="log" href="@{Secure.logout()}">Log out</a>
				</div>
				
				<div id="userActivity">
					<h4>Newest activity:</h4>
				
					#{if lastActivity}					
					<div class="activity">
						#{activity activity:lastActivity /}
					</div>
					#{/if}
				</div>
				#{/if}
	
				#{ifnot user}
					<div id="mainLogin" >
						#{form @Secure.authenticate()}
							<div id="loginInputs">
								<label for="username">&{'secure.username'}</label>
								<input type="text" name="username" id="username" size="10" value="${flash.username}" />
							</div>
							<div id="loginInputs">
								<label for="password">&{'secure.password'}</label>
								<input type="password" name="password" id="password" size="10" value="" />
							</div>
							<div id="loginInputs">
								<input type="checkbox" name="remember" id="remember" size="10" value="true" ${flash.remember ? 'checked="true"' : ''} />
								<label for="remember">&{'secure.remember'}</label>
						
								<input type="submit" id="signin" value="&{'secure.signin'}" />
							</div>
						#{/form}			
						<div id="pulldownBackground">		
							#{pulldown label:'New User'}
    							#{form @Application.addUser()}
    							
    							<ul>
									<li id="loginInputs">Username: <input type="text" id="newusername" name="newusername" /></li>
	    							<li id="loginInputs">Email: <input type="text" id="email" name="email" /></li>
	    							<li id="loginInputs">Password: <input type="password" id="newPassword" name="password" /></li>
	    							<li id="loginInputs">Confirm Password: <input type="password" id="newPassword2" name="password2" /></li>
	    							<li id="loginInputs"><input type="submit" id="register" value="Register" /></li>
	    						</ul>
	    				
								#{/form}
    						#{/pulldown}
    					</div>
					</div>
					
				#{/ifnot}
			
	    	</div>
	    	<div id="main-left">
	    		<div id="banner">
	    			<a href="@{Application.index()}"><img src="@{'/public/images/Banner.png'}" width="850" height="100" border="0"/></a>
	    		</div>
	
				<div id="menu">
					<a class="button" href="@{Application.index()}">Home</a>
					#{secure.check 'user'}
						<a class="button" href="@{Users.index()}">new question</a>
					#{/secure.check}
					
					#{if get_permalink == questions}
						<a class="button" href="#answerForm">add answer</a>
					#{/if}	
					#{secure.check 'admin'}
						<a class="button" href="@{Admin.index()}">Admin</a>
					#{/secure.check}
						
						<div id="search">
							#{form @Users.searchResults()}
								<input type="text" name="toSearch" id="toSearch"/>
								<input type="submit" value="search" />
							#{/form}
						</div>
				</div>
	
				<div id="content">
					#{if flash.error}
						<p class="error">
							&{flash.error}
						</p>
					#{/if}
					#{if flash.success}
						<p class="success">
						#{if user}
							&{flash.success, user.username}
						#{/if}
						#{ifnot user}
							&{flash.success}
						#{/ifnot}
						
						</p>
					#{/if}
				  	  #{doLayout /}
				</div>
			</div>	
		</div>
		<script type="text/javascript" src="/public/markdown/wmd.js"></script>
					
<div id="return_top">
	<a href="#main">&nbsp;</a>
</div>
    </body>
</html>
